<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gmail Crew AI</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">Gmail Crew AI</div>
      <div class="spacer"></div>
      <div id="user-info" class="user-info">
        <span id="user-email" class="muted">Not signed in</span>
        <button id="btn-signin" class="secondary">Sign In</button>
        <button id="btn-signout" class="secondary" style="display:none;">Sign Out</button>
      </div>
      <div class="health" id="health-indicator">Checking…</div>
    </header>
    <main class="layout">
      <aside class="sidebar">
        <section class="panel">
          <h2>New Run</h2>
          <form id="run-form">
            <label class="checkbox-row" title="Use saved credentials from your account if available">
              <input id="use-saved" type="checkbox" checked>
              <span>Use saved settings</span>
              <span id="saved-indicator" class="chip muted" style="margin-left:auto;">Unknown</span>
            </label>
            <div class="field">
              <label for="email">Email Address</label>
              <input id="email" name="email" type="email" placeholder="you@gmail.com" required />
            </div>
            <div class="field">
              <label for="app_password">App Password</label>
              <input id="app_password" name="app_password" type="password" placeholder="16-character app password" required />
              <small>Use a Gmail App Password. Do not use your main password.</small>
            </div>
            <div class="field-inline">
              <div>
                <label for="email_limit">Emails</label>
                <input id="email_limit" name="email_limit" type="number" min="1" value="5" />
              </div>
              <div class="actions">
                <button type="submit">Start Run</button>
              </div>
            </div>
          </form>
        </section>

        <section class="panel">
          <h2>Settings</h2>
          <div class="field">
            <label for="settings-email">Email Address</label>
            <input id="settings-email" type="email" placeholder="you@gmail.com" />
          </div>
          <div class="field">
            <label for="settings-app-password">App Password (Gmail)</label>
            <input id="settings-app-password" type="password" placeholder="16-char app password" />
          </div>
          <div class="field">
            <label for="settings-signature-name">Signature Name</label>
            <input id="settings-signature-name" type="text" placeholder="Your Name" />
          </div>
          <div class="field">
            <label for="settings-signature">Signature Block</label>
            <textarea id="settings-signature" rows="3" placeholder="Best regards,
Your Name"></textarea>
          </div>
          <div class="actions"><button id="btn-save-settings">Save Settings</button></div>
          <small class="muted">Signed-in users can store settings securely (email + secret in Secret Manager).</small>
        </section>

        <section class="panel">
          <h2>Runs</h2>
          <div id="runs-list" class="runs-list"></div>
        </section>
      </aside>

      <section class="content">
        <div class="tabs">
          <button class="tab active" data-tab="logs">Logs</button>
          <button class="tab" data-tab="outputs">Outputs</button>
          <button class="tab" data-tab="status">Status</button>
          <button class="tab" data-tab="summary">Summary</button>
        </div>

        <div class="tabcontent active" id="tab-logs">
          <div class="toolbar">
            <div>Selected Run: <code id="selected-run">—</code></div>
            <div class="spacer"></div>
            <input id="log-filter" class="input-sm" placeholder="Filter logs (regex supported)" />
            <label class="checkbox"><input type="checkbox" id="wrap-logs" checked /> Wrap</label>
            <label class="checkbox"><input type="checkbox" id="pause-logs" /> Pause</label>
            <label class="checkbox"><input type="checkbox" id="autoscroll" checked /> Autoscroll</label>
            <button id="clear-logs" class="secondary">Clear</button>
            <button id="copy-logs">Copy</button>
          </div>
          <pre id="logs" class="logs"></pre>
        </div>

        <div class="tabcontent" id="tab-outputs">
          <div class="split">
            <div class="left">
              <div class="toolbar">
                <div>Latest Output Files</div>
                <div class="spacer"></div>
                <button id="refresh-output">Refresh</button>
              </div>
              <ul id="output-files" class="filelist"></ul>
            </div>
            <div class="right">
              <div class="toolbar">
                <div id="output-name">Select a file…</div>
              </div>
              <pre id="output-view" class="json"></pre>
            </div>
          </div>
        </div>

        <div class="tabcontent" id="tab-status">
          <div class="status-grid" id="status-grid">
            <div class="status-item"><div class="label">Runs</div><div class="value" id="stat-runs">0</div></div>
            <div class="status-item"><div class="label">Active</div><div class="value" id="stat-active">0</div></div>
            <div class="status-item"><div class="label">Completed</div><div class="value" id="stat-completed">0</div></div>
            <div class="status-item"><div class="label">Failed</div><div class="value" id="stat-failed">0</div></div>
          </div>
        </div>

        <div class="tabcontent" id="tab-summary">
          <div class="summary-grid">
            <section class="panel">
              <h2>Deleted <span id="count-deleted" class="chip"></span></h2>
              <ul id="sum-deleted" class="bullet-list"></ul>
            </section>
            <section class="panel">
              <h2>Not Deleted <span id="count-notdeleted" class="chip"></span></h2>
              <ul id="sum-notdeleted" class="bullet-list"></ul>
            </section>
            <section class="panel">
              <h2>Drafts <span id="count-drafts" class="chip"></span></h2>
              <ul id="sum-drafts" class="bullet-list"></ul>
            </section>
          </div>
        </div>
      </section>
    </main>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <script src="firebase.js"></script>
    <script src="app.js"></script>
  </body>
  </html>
